---
// src/components/seo/JsonLd.astro

interface Props {
  type?: 'website' | 'tool';
  title: string;
  description: string;
  url: string;
  imageUrl?: string;
  features?: string[];
}

const { 
  type = 'website', 
  title, 
  description, 
  url, 
  imageUrl = 'https://syntaxsnap.com/og-preview.jpg',
  features
} = Astro.props;

// Base schema that applies to EVERY page
const baseSchema = [
  {
    "@type": "WebSite",
    "@id": "https://syntaxsnap.com/#website",
    "url": "https://syntaxsnap.com",
    "name": "SyntaxSnap",
    "alternateName": ["Syntax Snap", "DigiTekLab SyntaxSnap"],
    "description": "Privacy-first suite of developer tools.",
    "publisher": { "@id": "https://syntaxsnap.com/#organization" }
  },
  {
    "@type": "Organization",
    "@id": "https://syntaxsnap.com/#organization",
    "name": "SyntaxSnap",
    "url": "https://syntaxsnap.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://syntaxsnap.com/logo.png",
      "width": 512,
      "height": 512
    },
    "sameAs": ["https://github.com/DigiTekLab-Official"],
    "contactPoint": {
      "@type": "ContactPoint",
      "email": "contact@syntaxsnap.com",
      "contactType": "customer support"
    }
  }
];

// Appends Software schema only if this page is a tool
const toolSchema = type === 'tool' ? {
  "@type": "SoftwareApplication",
  "name": title,
  "description": description,
  "url": url,
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Web Browser",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "image": imageUrl,
  "author": { "@id": "https://syntaxsnap.com/#organization" },
  // FIX: Removed the hardcoded 'aggregateRating' block to prevent Google Rich Snippet Penalties.
  
  // Conditionally spread the featureList if features array exists and has items
  ...(features && features.length > 0 ? { "featureList": features } : {})
} : null;

// Combine into a single JSON-LD graph
const schemaGraph = {
  "@context": "https://schema.org",
  "@graph": toolSchema ? [...baseSchema, toolSchema] : baseSchema
};
---

<script type="application/ld+json" set:html={JSON.stringify(schemaGraph)} />